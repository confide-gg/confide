{
	# Disable auto-redirects so HTTP works for those without valid certs (IPs)
	auto_https disable_redirects
}

http://{$DOMAIN}, https://{$DOMAIN} {
    # Optional: ACME Email for Let's Encrypt / ZeroSSL
    # email {$EMAIL}

	reverse_proxy server:8080 {
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
	}

	encode gzip zstd

	log {
		output stdout
		format json
		level INFO
	}

	header {
		-Server
		X-Frame-Options "DENY"
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "strict-origin-when-cross-origin"
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
		
        # HSTS (Uncomment if you want to force HTTPS strict security)
		# Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
	}
}
